# æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡

ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å›  -1 ã€‚

## æ™®é€šæ–¹æ³•

```js
var strStr = function (haystack, needle) {
  let hLen = haystack.length;
  let nLen = needle.length;
  // ä»ç¬¬ä¸€ä¸ªå¼€å§‹å‘ååŒ¹é…
  for (let i = 0; i <= hLen - nLen; i++) {
    // åŸå§‹å­—ç¬¦ä¸²çš„åŒ¹é…ä½ç½®
    let a = i;
    // ç›®æ ‡å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®
    let b = 0;
    while (b < nLen && haystack[a] === needle[b]) {
      a++;
      b++
    }
    // åŒ¹é…æˆåŠŸè¿”å›èµ·å§‹ä½ç½®
    if (b === nLen) return i
  }
  return -1
};
```

## KMP ç®—æ³•

åœ¨åŒ¹é…å‡ºé”™æ—¶ä¸æŠŠå­—ç¬¦ä¸²å®Œå…¨å›é€€é‡æ–°ä¸‹ä¸€ä½åŒ¹é…ï¼Œæ‰¾åˆ°å‰ç¼€è¡¨è¿›è¡Œå›é€€åç»§ç»­åŒ¹é…

å‰ç¼€è¡¨ nextæ•°ç»„

nextæ•°ç»„å°±å¯ä»¥æ˜¯å‰ç¼€è¡¨ï¼Œä½†æ˜¯å¾ˆå¤šå®ç°éƒ½æ˜¯æŠŠå‰ç¼€è¡¨ç»Ÿä¸€å‡ä¸€ï¼ˆå³ç§»ä¸€ä½ï¼Œåˆå§‹ä½ç½®ä¸º-1ï¼‰ä¹‹åä½œä¸ºnextæ•°ç»„ã€‚

```js
const next = new Array(needle.length).fill(0);
/**
    iï¼šå½“å‰å­ä¸²çš„åç¼€æœ«å°¾
    jï¼šä¸Šä¸€é¡¹å­ä¸²æœ€é•¿ç›¸ç­‰å‰åç¼€çš„ä¸‹ä¸€é¡¹ æˆ–è€… 0 ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ ä¸Šä¸€é¡¹å­ä¸²æœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦

    iä»1å¼€å§‹ï¼Œjä»0å¼€å§‹ã€‚å› ä¸º i å’Œ jéƒ½æ˜¯0çš„è¯åªæœ‰ä¸€ä¸ªï¼Œè‚¯å®šæ˜¯0ï¼Œç›¸å½“äºä¸Šé¢ä¾‹å­ä¸­çš„ a
*/
for (let i = 1, j = 0; i < m; i++) {
  1
  // whileå¾ªç¯ï¼Œè¦ä¸æ–­çš„å‘ä¸Šå¯»æ‰¾ã€‚
  while (j > 0 && needle[i] !== needle[j]) {
    // å¦‚æœä¸åŒï¼Œæˆ‘ä»¬è¦ä»æœªåŒ¹é…å¥½çš„åœ°æ–¹å¼€å§‹ç»§ç»­åŒ¹é…ã€‚
    // æœªåŒ¹é…å¥½çš„ä½ç½®æ˜¯é‚£é‡Œå‘¢ï¼Ÿ ğŸ‘‡
    // æˆ‘ä»¬çŸ¥é“ next æ•°ç»„çš„å€¼å°±ä»£è¡¨æ¯ä¸€æ¬¡å­ä¸²åŒ¹é…å¥½çš„é•¿åº¦ï¼Œ
    // å› ä¸ºæ•°ç»„æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥j - 1å°±æŒ‡å‘äº†ä¸Šä¸€ä¸ªå­ä¸²æœªåŒ¹é…å¥½çš„ä½ç½®ã€‚
    // å½“j === 0æ—¶ï¼Œè¯´æ˜è¦ä»å¤´å¼€å§‹é‡æ–°åŒ¹é…äº†
    j = next[j - 1];
  }
  // å¦‚æœå½“å‰å­ä¸²å‰åç¼€ç›¸ç­‰ï¼Œå°±å°†æ›´æ–°å­ä¸²ï¼Œj++ i++
  if (needle[i] == needle[j]) {
    j++;
  }
  // å°†å½“å‰å­ä¸²çš„æœ€é•¿ç›¸ç­‰å‰åç¼€æ·»åŠ åˆ°nextæ•°ç»„ä¸­
  next[i] = j;
}
```

```js
var strStr = function (haystack, needle) {
  let n = haystack.length
  let m = needle.length
  if (m === 0) return 0

  let next = new Array(m).fill(0)
  for (let i = 1, j = 0; i < m; i++) {
    while (j > 0 && needle[i] !== needle[j]) {
      j = next[j - 1]
    }
    if (needle[i] === needle[j]) {
      j++
    }
    next[i] = j
  }
  
  for (let i = 0, j = 0; i < n; i++) {
    // å¦‚æœå½“å‰i å’Œ jä¸ä¸€è‡´ï¼Œå°±å›é€€åˆ°ä¸Šä¸€ä¸ªç›¸ç­‰çš„ä½ç½®çš„ä¸‹ä¸€ä¸ªçœ‹çœ‹æ˜¯å¦åŒ¹é…
    // ä¼šä¸æ–­å›é€€ï¼Œ0ä¸ºå›é€€åˆ°è¾¹ç•Œï¼Œå½“å›é€€åˆ°0æ„å‘³ç€è¦é‡æ–°ä»å¤´å¼€å§‹åŒ¹é…
    while (j > 0 && haystack[i] !== needle[j]) {
      j = next[j - 1]
    }
    if (haystack[i] === needle[j]) {
      j++
    }
    // å½“j å’Œ mçš„é•¿åº¦ç›¸ç­‰æ—¶ï¼Œå°±è¯´æ˜å­˜åœ¨
    if (j === m) {
      return i - m + 1
    }
  }
  return -1
};
```
